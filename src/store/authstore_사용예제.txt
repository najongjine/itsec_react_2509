// src/App.tsx

import React from 'react';
import { useAuthStore } from './stores/authStore';
import type { UserInfoType } from './types/global_types'; // ê°€ì •í•œ íƒ€ì… ê²½ë¡œ

// --- 1. ì‚¬ìš©ì ì •ë³´ë¥¼ í‘œì‹œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ (Store ìƒíƒœ ì½ê¸°) ---
const UserProfile: React.FC = () => {
  // `selectIsLoggedIn` ì…€ë ‰í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ í™•ì¸
  const isLoggedIn = useAuthStore((state) => state.userInfo !== null); 
  const userInfo = useAuthStore((state) => state.userInfo);
  
  if (!isLoggedIn || !userInfo) {
    return (
      <div style={{ padding: '15px', border: '1px solid #ccc', borderRadius: '5px' }}>
        <h3>ğŸ‘¤ ì‚¬ìš©ì í”„ë¡œí•„</h3>
        <p>ë¡œê·¸ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤.</p>
      </div>
    );
  }

  return (
    <div style={{ padding: '15px', border: '1px solid #007bff', borderRadius: '5px', marginTop: '20px' }}>
      <h3>âœ… ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´</h3>
      <p>UID: **{userInfo.uidVarchar}**</p>
      <p>ì´ë¦„: **{userInfo.displayName}** ({userInfo.realName})</p>
      <p>ì´ë©”ì¼: **{userInfo.emailVarchar}**</p>
      <p>í† í° (ê¸¸ì´): {userInfo.token.length}</p>
    </div>
  );
};

// --- 2. ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒì„ ì²˜ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ (Store ì•¡ì…˜ í˜¸ì¶œ) ---
const LoginComponent: React.FC = () => {
  // ìƒíƒœì™€ ì•¡ì…˜ì„ ìŠ¤í† ì–´ì—ì„œ í•œ ë²ˆì— ê°€ì ¸ì˜¤ê¸°
  const { userInfo, login, logout } = useAuthStore();
  const isLoggedIn = userInfo !== null;

  // ë”ë¯¸ ë¡œê·¸ì¸ ì •ë³´ ìƒì„± í•¨ìˆ˜ (ì‹¤ì œë¡œëŠ” Firebase ë¡œê·¸ì¸ ê²°ê³¼ + ì„œë²„ DB ì •ë³´)
  const getDummyUserInfo = (): UserInfoType => ({
    id: 101,
    username: 'fire_user_1',
    createdDt: new Date().toISOString(),
    updatedDt: new Date().toISOString(),
    realName: 'ê¹€ê°œë°œ',
    profileUrl: 'https://example.com/p/kim',
    uidVarchar: 'google-firebase-uid-abc123xyz', // Firebase UID
    emailVarchar: 'kim.dev@google.com',
    displayName: 'Kim Dev',
    providerId: 'google.com',
    metadata: '{"lastSignInTime":"..."}',
    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiJmaXJlYmFzZS11aWQtYWJjMTIzeHl6IiwiaWF0IjoxNjQyMjAxMjAwfQ.SFlU6F0L4pYQ7a', // ë”ë¯¸ JWT
  });

  const handleLogin = () => {
    const newUser = getDummyUserInfo();
    login(newUser, newUser.token); // ë¡œê·¸ì¸ ì•¡ì…˜ í˜¸ì¶œ
    alert('ë¡œê·¸ì¸ ì„±ê³µ! ìƒíƒœê°€ Zustandì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
  };

  const handleLogout = () => {
    logout(); // ë¡œê·¸ì•„ì›ƒ ì•¡ì…˜ í˜¸ì¶œ
    alert('ë¡œê·¸ì•„ì›ƒ ì„±ê³µ! ìƒíƒœê°€ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
  };

  return (
    <div style={{ marginTop: '30px' }}>
      {isLoggedIn ? (
        <button 
          onClick={handleLogout} 
          style={{ padding: '10px 20px', backgroundColor: '#dc3545', color: 'white', border: 'none', cursor: 'pointer' }}
        >
          ğŸ‘‹ ë¡œê·¸ì•„ì›ƒ
        </button>
      ) : (
        <button 
          onClick={handleLogin} 
          style={{ padding: '10px 20px', backgroundColor: '#28a745', color: 'white', border: 'none', cursor: 'pointer' }}
        >
          ğŸ”‘ Google ë¡œê·¸ì¸ ì‹œë®¬ë ˆì´ì…˜
        </button>
      )}
    </div>
  );
};

// --- 3. ë©”ì¸ ì•± ë ˆì´ì•„ì›ƒ ---
const App: React.FC = () => {
  return (
    <div style={{ fontFamily: 'Arial, sans-serif', padding: '40px', maxWidth: '600px', margin: '0 auto' }}>
      <h1>Zustand Auth Store ì˜ˆì œ</h1>
      <LoginComponent />
      <UserProfile />
    </div>
  );
};

export default App;